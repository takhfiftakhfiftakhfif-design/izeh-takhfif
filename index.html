<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªØ®ÙÛŒÙØ§Øª Ø§ÛŒØ°Ù‡ | Ù…Ø±Ø¬Ø¹ ØªØ¨Ù„ÛŒØºØ§Øª Ù‡ÙˆØ´Ù…Ù†Ø¯</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    
    <style>
        :root { --main: #ff3e3e; --bg: #f7f7f7; --yellow-box: rgba(255, 253, 208, 0.98); }
        body { font-family: Tahoma, sans-serif; background: var(--bg); margin: 0; padding-bottom: 95px; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }

        /* Ù†ÙˆØ§Ø± Ù…ØªØ­Ø±Ú© */
        .marquee-container { background: #000; color: #fff; padding: 10px 0; overflow: hidden; border-bottom: 2px solid var(--main); }
        .marquee-content { display: inline-block; white-space: nowrap; animation: marquee-scroll 25s linear infinite; font-weight: bold; }
        @keyframes marquee-scroll { from { transform: translateX(-100%); } to { transform: translateX(100vw); } }

        /* Ù‡Ø¯Ø± */
        .top-nav { text-align: center; background: #fff; padding: 20px 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .search-mini { width: 85%; padding: 12px; border-radius: 25px; border: 1.5px solid #ddd; outline: none; margin-top: 15px; text-align: center; }
        
        /* Ø§Ø³ØªÙˆØ±ÛŒ Ø¨Ø§Ø± */
        .story-bar { display: flex; gap: 15px; padding: 20px; background: #fff; overflow-x: auto; scrollbar-width: none; }
        .story-bar::-webkit-scrollbar { display: none; }
        .story-circle { min-width: 75px; text-align: center; cursor: pointer; }
        .story-circle img { width: 66px; height: 66px; border-radius: 50%; border: 3px solid var(--main); padding: 2px; object-fit: cover; }
        
        /* Ù¾Ø§Ù¾â€ŒØ¢Ù¾ VIP */
        #business-popup { position: fixed; bottom: -150px; left: 15px; right: 15px; background: linear-gradient(135deg, #222, #000); border: 2px solid #ffd700; border-radius: 20px; padding: 12px; z-index: 10006; display: flex; align-items: center; gap: 12px; transition: all 0.5s ease; box-shadow: 0 10px 30px rgba(0,0,0,0.5); cursor: pointer; }
        #business-popup.active { bottom: 100px; }
        #business-popup img { width: 55px; height: 55px; border-radius: 12px; border: 2px solid #ffd700; object-fit: cover; }

        /* Ù…ÙˆØ¯Ø§Ù„ Ø§ØµÙ„ÛŒ */
        #storyModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 99999; color: #fff; }
        .media-box { height: 100%; width: 100%; display: flex; align-items: center; justify-content: center; }
        .media-box video, .media-box img { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        .prog-container { position: absolute; top: 10px; left: 10px; right: 10px; display: flex; gap: 4px; z-index: 10001; }
        .p-bar { flex: 1; height: 3px; background: rgba(255,255,255,0.3); border-radius: 2px; }
        .p-fill { height: 100%; background: #fff; width: 0%; }
        
        .info-box { position: absolute; bottom: 30px; left: 5%; width: 90%; background: var(--yellow-box); padding: 15px; border-radius: 20px; box-sizing: border-box; color: #000; text-align: center; }
        .btn-row { display: flex; gap: 8px; margin-top: 10px; }
        .small-btn { flex: 1; padding: 12px; border-radius: 12px; color: #fff; font-weight: bold; text-decoration: none; font-size: 13px; text-align: center; }
        .close-modal { position: absolute; top: 25px; left: 15px; font-size: 25px; color: #fff; background: rgba(0,0,0,0.5); border: none; width: 40px; height: 40px; border-radius: 50%; z-index: 100005; }
    </style>
</head>
<body>

    <div class="marquee-container">
        <div class="marquee-content" id="text-marq">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† ØªØ®ÙÛŒÙâ€ŒÙ‡Ø§...</div>
    </div>

    <div class="top-nav">
        <h2>ØªØ®ÙÛŒÙØ§Øª Ø§ÛŒØ°Ù‡</h2>
        <input type="text" id="searchInput" class="search-mini" placeholder="Ø¬Ø³ØªØ¬Ùˆ..." onkeyup="filterContent()">
    </div>

    <div class="story-bar" id="story-render"></div>

    <div style="padding: 15px;">
        <div class="swiper mySwiper">
            <div class="swiper-wrapper" id="card-render"></div>
        </div>
    </div>

    <div id="business-popup" onclick="openVipFromPop()">
        <img id="pop-biz-img" src="" alt="">
        <div style="flex:1">
            <h4 id="pop-biz-name" style="margin:0; color:#ffd700; font-size:13px;"></h4>
            <p id="pop-biz-desc" style="margin:3px 0 0; color:#fff; font-size:11px;"></p>
        </div>
    </div>

    <div id="storyModal">
        <div class="prog-container" id="prog-bars"></div>
        <button class="close-modal" onclick="closeMe()">âœ•</button>
        <div class="media-box" id="media-view"></div>
        <div class="info-box">
            <h2 id="st-name" style="margin:0; font-size:18px;"></h2>
            <p id="st-desc" style="font-size:13px; margin: 10px 0;"></p>
            <div id="st-btns" class="btn-row"></div>
        </div>
    </div>

    <script>
        let allItems = [], timer, progress = 0, currentItem = null, slideIndex = 0, currentVipId = null;

        async function startup() {
            try {
                const t = `?v=${Date.now()}`;
                const [conf, stor, off] = await Promise.all([
                    fetch('config.json' + t).then(r => r.json()),
                    fetch('stories.json' + t).then(r => r.json()),
                    fetch('offers.json' + t).then(r => r.json())
                ]);
                
                document.getElementById('text-marq').innerText = conf.marqueeText.join(" âš¡ ");
                
                // Ø¨Ø±Ú†Ø³Ø¨ Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØ¯Ø§Ø®Ù„ Ø¢ÛŒØ¯ÛŒ
                const sData = stor.map(i => ({...i, dataType: 'story'}));
                const oData = off.map(i => ({...i, dataType: 'offer'}));
                
                allItems = [...sData, ...oData];
                render(sData, oData);
                setTimeout(showPopup, 4000);
            } catch (e) { console.error("Load Error"); }
        }

        function render(stories, offers) {
            const sDiv = document.getElementById('story-render'), cDiv = document.getElementById('card-render');
            sDiv.innerHTML = stories.map(i => `
                <div class="story-circle" onclick="openMe(${i.id}, 'story')">
                    <img src="${i.src || i.slides[0]}"><br><span style="font-size:11px;">${i.name}</span>
                </div>`).join('');

            cDiv.innerHTML = offers.map(i => `
                <div class="swiper-slide">
                    <div style="background:#fff; border-radius:15px; overflow:hidden; border:1px solid #eee;" onclick="openMe(${i.id}, 'offer')">
                        <img src="${i.src || i.slides[0]}" style="width:100%; height:120px; object-fit:cover;">
                        <div style="padding:10px; text-align:center; font-weight:bold; font-size:12px;">${i.name}</div>
                    </div>
                </div>`).join('');

            new Swiper(".mySwiper", { slidesPerView: 2.3, spaceBetween: 10 });
        }

        function showPopup() {
            const vips = allItems.filter(i => i.vip === true);
            if (vips.length === 0) return;
            const target = vips[Math.floor(Math.random() * vips.length)];
            currentVipId = target.id;
            
            document.getElementById('pop-biz-img').src = target.src || target.slides[0];
            document.getElementById('pop-biz-name').innerText = target.name;
            document.getElementById('pop-biz-desc').innerText = "Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ÙˆÛŒÚ˜Ù‡...";
            
            const el = document.getElementById('business-popup');
            el.classList.add('active');
            setTimeout(() => el.classList.remove('active'), 10000);
        }

        function openVipFromPop() {
            if(currentVipId) {
                const item = allItems.find(x => x.id == currentVipId && x.vip === true);
                if(item) openMe(item.id, item.dataType);
                document.getElementById('business-popup').classList.remove('active');
            }
        }

        function openMe(id, type) {
            currentItem = allItems.find(x => x.id == id && x.dataType == type);
            if(!currentItem) return;
            slideIndex = 0; 
            document.getElementById('storyModal').style.display = 'block';
            showSlide();
        }

        function showSlide() {
            const slides = Array.isArray(currentItem.slides) ? currentItem.slides : [currentItem.src];
            const src = slides[slideIndex];
            const view = document.getElementById('media-view');
            
            // Ù†ÙˆØ§Ø± Ù¾ÛŒØ´Ø±ÙØª
            document.getElementById('prog-bars').innerHTML = slides.map((_, i) => `<div class="p-bar"><div class="p-fill" id="fill-${i}" style="width:${i < slideIndex ? '100%' : '0%'}"></div></div>`).join('');

            // ØªØ´Ø®ÛŒØµ Ùˆ Ù¾Ø®Ø´ ÙˆÛŒØ¯ÛŒÙˆ ÛŒØ§ Ø¹Ú©Ø³
            if (src.toLowerCase().includes('.mp4')) {
                view.innerHTML = `<video id="st-video" autoplay playsinline muted style="width:100%;"><source src="${src}" type="video/mp4"></video>`;
                const v = document.getElementById('st-video');
                v.onloadedmetadata = () => {
                    v.play(); // Ù¾Ø®Ø´ Ø§Ø¬Ø¨Ø§Ø±ÛŒ
                    startTimer(v.duration * 1000);
                };
                v.onerror = () => startTimer(5000);
            } else {
                view.innerHTML = `<img src="${src}">`;
                startTimer(5000);
            }

            document.getElementById('st-name').innerText = currentItem.name;
            document.getElementById('st-desc').innerText = currentItem.desc;
            document.getElementById('st-btns').innerHTML = `
                <a href="tel:${currentItem.phone}" class="small-btn" style="background:#2ecc71">ğŸ“ ØªÙ…Ø§Ø³</a>
                <a href="${currentItem.link}" target="_blank" class="small-btn" style="background:var(--main)">ğŸ“¸ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…</a>
            `;
        }

        function startTimer(duration) {
            progress = 0; clearInterval(timer);
            timer = setInterval(() => {
                progress += (100 / (duration / 100));
                let f = document.getElementById(`fill-${slideIndex}`);
                if(f) f.style.width = Math.min(progress, 100) + '%';
                if (progress >= 100) {
                    clearInterval(timer);
                    changeSlide();
                }
            }, 100);
        }

        function changeSlide() {
            const slides = Array.isArray(currentItem.slides) ? currentItem.slides : [currentItem.src];
            slideIndex++;
            if (slideIndex >= slides.length) closeMe();
            else showSlide();
        }

        function closeMe() {
            clearInterval(timer);
            const v = document.getElementById('st-video');
            if(v) { v.pause(); v.src = ""; }
            document.getElementById('storyModal').style.display = 'none';
        }

        window.onload = startup;
    </script>
</body>
</html>
